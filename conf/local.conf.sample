# StarryOS Yocto 构建本地配置
#
# 本文件由 meta-starry 项目生成

# ==================== 机器选择 ====================
# 可选值:
#   aarch64-qemu-virt      - ARM64 QEMU (默认)
#   riscv64-qemu-virt      - RISC-V 64 QEMU
#   loongarch64-qemu-virt  - LoongArch64 QEMU
#   x86_64-qemu-q35        - x86_64 QEMU
MACHINE ?= "aarch64-qemu-virt"

# ==================== 发行版 ====================
DISTRO = "starryos"

# ==================== ArceOS 构建参数 ====================
# 取消注释以覆盖默认值

# CPU 核心数 (默认: 4)
#ARCEOS_SMP = "8"

# 日志级别: off/error/warn/info/debug/trace (默认: warn)
#ARCEOS_LOG = "debug"

# 内存大小 (默认: 由平台配置决定)
#ARCEOS_MEM = "2G"

# 调试信息: y/n (默认: y)
#ARCEOS_DWARF = "y"

# ==================== 并行构建 ====================
# 根据你的 CPU 核心数调整
BB_NUMBER_THREADS = "8"
PARALLEL_MAKE = "-j 8"

# ==================== 跳过版本检查 ====================
# 跳过 make 4.2.1 版本警告（Kylin 是基于 Debian 的，但 sanity.bbclass 没有识别）
INHERIT:remove = "sanity"

# ==================== 下载与缓存目录 ====================
# 可选：使用共享目录加速多次构建
#DL_DIR = "/home/yean/code/downloads"
#SSTATE_DIR = "/home/yean/code/sstate"
#DL_DIR = "/home/yocto/yocto-cache/downloads"
#SSTATE_DIR = "/home/yocto/yocto-cache/sstate"


# ==================== EXTERNALSRC 配置 ====================
# 说明：
#   1. 如果使用 repo 管理多仓（推荐），starry_git.bb 会自动检测 .repo/ 目录
#      并启用 EXTERNALSRC，无需手动配置
#
#   2. 如果需要覆盖自动检测（如使用不同路径），可手动设置：
#      EXTERNALSRC_pn-starry = "/path/to/your/StarryOS"
#      EXTERNALSRC_BUILD_pn-starry = "${EXTERNALSRC_pn-starry}"
#
#
# 示例：
#EXTERNALSRC_pn-starry = "/home/yean/code/my-custom-starryos"
#EXTERNALSRC_BUILD_pn-starry = "${EXTERNALSRC_pn-starry}"

# ==================== 国内镜像源 ====================
# 使用国内镜像加速源码下载（中科院软件所镜像站）
# 注意：仅作为备选镜像，不代理 Git 仓库
#INHERIT += "own-mirrors"
#SOURCE_MIRROR_URL = "https://mirror.iscas.ac.cn/yocto/mirror/sources/"

# PREMIRRORS 会强制优先使用镜像，但镜像可能不完整，已禁用
# 如需启用，请确保镜像源有完整的文件
#PREMIRRORS:append = "\
#  git://.*/.* https://mirrors.xxx.com/yocto/git2/ \n \
#  gitsm://.*/.* https://mirrors.xxx.com/yocto/git2/ \n \
#  http://.*/.* https://mirror.iscas.ac.cn/yocto/mirror/sources/ \n \
#  https://.*/.* https://mirror.iscas.ac.cn/yocto/mirror/sources/ \n \
#  ftp://.*/.* https://mirror.iscas.ac.cn/yocto/mirror/sources/ \n \
#"

# ==================== 磁盘空间监控 ====================
BB_DISKMON_DIRS ??= "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    HALT,${TMPDIR},100M,1K \
    HALT,${DL_DIR},100M,1K \
    HALT,${SSTATE_DIR},100M,1K \
    HALT,/tmp,10M,1K"

# ==================== 构建选项 ====================
PATCHRESOLVE = "noop"
USER_CLASSES ?= "buildstats"

# 版本标识
CONF_VERSION = "3"

# 临时配置：运行哪个测试
TEST_SUITES = "ci unixbench stress"